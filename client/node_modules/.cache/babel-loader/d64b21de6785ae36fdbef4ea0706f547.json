{"ast":null,"code":"var _jsxFileName = \"/Users/kevii/Desktop/memeApp/my-app/src/App.js\",\n    _s = $RefreshSig$();\n\nimport './App.css';\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [meme, setMeme] = useState([]);\n  const [currentMeme, setCurrentMeme] = useState(2);\n  const [nextMeme, setNextMeme] = useState(currentMeme + 1);\n  const [seconds, setSeconds] = useState(15);\n  const [displayCurrent, setDisplayCurrent] = useState(true);\n  const [length, setLength] = useState();\n  const CLOCK = 5;\n  const WEEK_IN_MS = 604800000;\n  const TEN_MIN_IN_MS = 600000;\n  useEffect(() => {\n    getData();\n  }, []);\n  useEffect(() => {\n    setTimeout(() => {\n      if (seconds !== 0) {\n        setSeconds(seconds - 1);\n      } else {\n        if (displayCurrent) {\n          setDisplayCurrent(false);\n\n          if (length > nextMeme + 1) {\n            setCurrentMeme(nextMeme + 1);\n\n            while (!meme[currentMeme].media && meme[currentMeme].media === '') {\n              setCurrentMeme(nextMeme + 1);\n            }\n          } else {\n            setMeme(shuffle(meme));\n            setCurrentMeme(0);\n          }\n        } else {\n          setDisplayCurrent(true);\n\n          if (length > currentMeme + 1) {\n            setNextMeme(currentMeme + 1);\n\n            while (!meme[nextMeme].media && meme[nextMeme].media === '') {\n              setCurrentMeme(nextMeme + 1);\n            }\n          } else {\n            setMeme(shuffle(meme));\n            setNextMeme(0);\n          }\n        }\n\n        setSeconds(CLOCK);\n      }\n    }, 1000);\n  }, [seconds]);\n  useEffect(() => {\n    console.log(meme);\n  }, [meme]);\n\n  function shuffle(array) {\n    let currentIndex = array.length;\n    let randomIndex;\n\n    while (currentIndex != 0) {\n      randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex--;\n      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n    }\n\n    return array;\n  }\n\n  const getData = () => {\n    fetch(\"/members\").then(res => res.json()).then(data => {\n      setLength(Object.keys(data.title).length);\n      let shuffleMeme = [];\n\n      for (var i = 0; i < Object.keys(data.title).length; i++) {\n        //   setMeme(preState => [\n        //     ...preState, {media:data.media['?',i],\n        //   score:data.score['?',i],\n        // title:data.title['?',i]}\n        //   ])\n        shuffleMeme.push({\n          media: data.media[('?', i)],\n          score: data.score[('?', i)],\n          title: data.title[('?', i)]\n        });\n      }\n\n      setMeme(shuffle(shuffleMeme));\n    });\n  };\n\n  const updateData = () => {\n    fetch(\"/updateMeme\");\n  };\n\n  useEffect(() => {\n    const currentTime = new Date().getTime(); //current unix timestamp\n\n    const execTime = new Date().setHours(19, 1, 0); //API call time = today at 20:00\n\n    let timeLeft;\n\n    if (currentTime < execTime) {\n      //it's currently earlier than 20:00\n      timeLeft = execTime - currentTime;\n    } else {\n      //it's currently later than 20:00, schedule for tomorrow at 20:00\n      timeLeft = execTime + WEEK_IN_MS - currentTime;\n    }\n\n    console.log(timeLeft);\n    setTimeout(function () {\n      updateData();\n      setTimeout(function () {\n        getData();\n      }, TEN_MIN_IN_MS);\n      setInterval(function () {\n        updateData();\n        setTimeout(function () {\n          getData();\n        }, TEN_MIN_IN_MS);\n      }, WEEK_IN_MS); //repeat every week\n    }, timeLeft); //wait until 20:00 as calculated above\n  }, []);\n  useEffect(() => {\n    if (meme.length > 0) {\n      fetch(\"/checkImage?src=\" + meme[currentMeme].media).then(res => {\n        return res.json();\n      }).then(isFound => {\n        console.log(isFound);\n\n        if (isFound === 404) {\n          if (length > currentMeme + 1 && length > nextMeme + 1) {\n            setCurrentMeme(currentMeme + 1);\n            setNextMeme(nextMeme + 1);\n            console.log(\"skipped\");\n          } else {\n            setMeme(shuffle(meme));\n            setCurrentMeme(0);\n          }\n        }\n      });\n    }\n  }, [currentMeme]);\n  useEffect(() => {\n    if (meme.length > 0) {\n      fetch(\"/checkImage?src=\" + meme[nextMeme].media).then(res => {\n        return res.json();\n      }).then(isFound => {\n        console.log(isFound);\n\n        if (isFound === 404) {\n          if (length > currentMeme + 1 && length > nextMeme + 1) {\n            setCurrentMeme(currentMeme + 1);\n            setNextMeme(nextMeme + 1);\n          } else {\n            setMeme(shuffle(meme));\n            setCurrentMeme(0);\n          }\n        }\n      });\n    }\n  }, [nextMeme]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"App-header\",\n      children: [meme[currentMeme + 1] ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: displayCurrent ? null : {\n            display: 'none'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: meme[currentMeme].title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            alt: \"current meme\",\n            src: meme[currentMeme].media,\n            onError: e => {\n              if (length > currentMeme + 1 && length > nextMeme + 1) {\n                setCurrentMeme(currentMeme + 1);\n                setNextMeme(nextMeme + 1);\n                console.log(\"error img\");\n                e.target.onerror = null;\n                e.target.src = meme[currentMeme].media;\n              } else {\n                setMeme(shuffle(meme));\n                setNextMeme(1);\n                setCurrentMeme(0);\n                console.log(\"error img\");\n                e.target.onerror = null;\n                e.target.src = meme[currentMeme].media;\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: displayCurrent ? {\n            display: 'none'\n          } : null,\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: meme[nextMeme].title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            alt: \"next meme\",\n            src: meme[nextMeme].media,\n            onError: e => {\n              if (length > currentMeme + 1 && length > nextMeme + 1) {\n                setNextMeme(nextMeme + 1);\n                setCurrentMeme(currentMeme + 1);\n                console.log(\"error img\");\n                e.target.onerror = null;\n                e.target.src = meme[nextMeme].media;\n              } else {\n                setMeme(shuffle(meme));\n                setNextMeme(0);\n                setCurrentMeme(1);\n                console.log(\"error img\");\n                e.target.onerror = null;\n                e.target.src = meme[nextMeme].media;\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 36\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"timer\",\n        children: seconds\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 190,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"Rf0GlLbz9EbV5f1eu32GTuP6+EY=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/kevii/Desktop/memeApp/my-app/src/App.js"],"names":["React","useState","useEffect","App","meme","setMeme","currentMeme","setCurrentMeme","nextMeme","setNextMeme","seconds","setSeconds","displayCurrent","setDisplayCurrent","length","setLength","CLOCK","WEEK_IN_MS","TEN_MIN_IN_MS","getData","setTimeout","media","shuffle","console","log","array","currentIndex","randomIndex","Math","floor","random","fetch","then","res","json","data","Object","keys","title","shuffleMeme","i","push","score","updateData","currentTime","Date","getTime","execTime","setHours","timeLeft","setInterval","isFound","display","e","target","onerror","src"],"mappings":"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","sourcesContent":["import './App.css';\nimport React, { useState, useEffect } from 'react';\n\n\nfunction App() {\n  const [meme,setMeme] = useState([])\n  const [currentMeme,setCurrentMeme] = useState(2)\n  const [nextMeme,setNextMeme] = useState(currentMeme+1)\n  const [seconds,setSeconds] = useState(15)\n  const [displayCurrent, setDisplayCurrent] = useState(true)\n  const [length,setLength] = useState()\n  const CLOCK = 5\n  const WEEK_IN_MS = 604800000\n  const TEN_MIN_IN_MS = 600000\n\n  useEffect(() => {\n      getData()\n  },[])\n\n  useEffect(() => {\n    setTimeout(() => {\n      if(seconds!==0){\n      setSeconds(seconds-1)}\n      else{\n        if(displayCurrent){\n          setDisplayCurrent(false)\n          if(length>(nextMeme+1)){\n\n            setCurrentMeme(nextMeme+1)\n            while(!meme[currentMeme].media && meme[currentMeme].media===''){\n              setCurrentMeme(nextMeme+1)\n            }\n          \n          }\n          else{\n            setMeme(shuffle(meme))\n            setCurrentMeme(0)\n          }\n\n        }\n        else{\n          setDisplayCurrent(true)\n          if(length>(currentMeme+1)){\n            setNextMeme(currentMeme+1)\n            while(!meme[nextMeme].media && meme[nextMeme].media===''){\n              setCurrentMeme(nextMeme+1)\n            }\n          \n          }\n          else{\n            setMeme(shuffle(meme))\n            setNextMeme(0)\n          }\n        }\n        setSeconds(CLOCK)\n        \n      }\n    }, 1000);\n    \n  }, [seconds])\n\n  useEffect(()=>{\n    console.log(meme)\n  },[meme])\n\n  function shuffle(array) {\n    let currentIndex = array.length\n    let randomIndex\n\n    while (currentIndex != 0) {\n\n      randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex--;\n\n      [array[currentIndex], array[randomIndex]] = [\n        array[randomIndex], array[currentIndex]];\n    }\n    \n    return array\n      \n    }\n\n    const getData = () => {\n      fetch(\"/members\").then(\n        res => res.json()\n      )\n      .then(data => {\n        setLength(Object.keys(data.title).length)\n        let shuffleMeme = []\n        for (var i =0; i<Object.keys(data.title).length; i++){\n      //   setMeme(preState => [\n      //     ...preState, {media:data.media['?',i],\n      //   score:data.score['?',i],\n      // title:data.title['?',i]}\n      //   ])\n  \n          shuffleMeme.push({media:data.media['?',i],\n             score:data.score['?',i],\n           title:data.title['?',i]})\n  \n  \n      }\n      setMeme(shuffle(shuffleMeme))\n      })\n    }\n\n    const updateData = () => {\n      fetch(\"/updateMeme\")\n    }\n\n    useEffect(() => {\n\n      const currentTime = new Date().getTime();  //current unix timestamp\n      const execTime = new Date().setHours(19,1,0);  //API call time = today at 20:00\n      let timeLeft;\n      if(currentTime < execTime) {\n        //it's currently earlier than 20:00\n        timeLeft = execTime - currentTime;\n      } else {\n        //it's currently later than 20:00, schedule for tomorrow at 20:00\n        timeLeft = execTime + WEEK_IN_MS - currentTime\n      }\n      console.log(timeLeft)\n      \n      setTimeout(function() {\n\n        updateData()\n          setTimeout(function() {\n            getData()\n          }, TEN_MIN_IN_MS)\n\n        setInterval(function() {\n          updateData()\n          setTimeout(function() {\n            getData()\n          }, TEN_MIN_IN_MS)\n    \n        }, WEEK_IN_MS);  //repeat every week\n      }, timeLeft);  //wait until 20:00 as calculated above\n    },[])\n\n    useEffect(() => {\n      if(meme.length > 0) {\n      fetch(\"/checkImage?src=\"+meme[currentMeme].media)\n      .then(res => {\n        return res.json()\n      })\n      .then(isFound => {\n        console.log(isFound)\n        if (isFound === 404){\n          if(length>(currentMeme+1) && length>(nextMeme+1)){\n          setCurrentMeme(currentMeme+1)\n          setNextMeme(nextMeme+1)\n          console.log(\"skipped\")\n          }\n          else{\n            setMeme(shuffle(meme))\n            setCurrentMeme(0)\n          }\n        }\n      }) \n    }\n    },[currentMeme])\n\n    useEffect(() => {\n      if(meme.length > 0) {\n        fetch(\"/checkImage?src=\"+meme[nextMeme].media)\n        .then(res => {\n          return res.json()\n        })\n        .then(isFound => {\n          console.log(isFound)\n          if (isFound === 404){\n            if(length>(currentMeme+1) && length>(nextMeme+1)){\n              setCurrentMeme(currentMeme+1)\n              setNextMeme(nextMeme+1)\n            }\n            else{\n              setMeme(shuffle(meme))\n              setCurrentMeme(0)\n            }\n          }\n        })\n      }\n       \n    },[nextMeme])\n\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n      {meme[currentMeme+1]?        <div>\n\n        <div style={displayCurrent?null:{display:'none'}}>\n            <h3>{meme[currentMeme].title}</h3>\n            <img alt=\"current meme\" src={meme[currentMeme].media} onError={(e) => {\n              if(length>(currentMeme+1) && length>(nextMeme+1)){\n              setCurrentMeme(currentMeme+1)\n              setNextMeme(nextMeme+1)\n              console.log(\"error img\")\n              e.target.onerror = null\n              e.target.src=meme[currentMeme].media\n            }\n            else{\n              setMeme(shuffle(meme))\n              setNextMeme(1)\n              setCurrentMeme(0)\n              console.log(\"error img\")\n              e.target.onerror = null\n              e.target.src=meme[currentMeme].media\n            }}}></img>\n            </div>\n\n            <div style={displayCurrent?{display:'none'}:null}>\n            <h3>{meme[nextMeme].title}</h3>\n            <img alt=\"next meme\" src={meme[nextMeme].media} onError={(e) => {\n              if(length>(currentMeme+1) && length>(nextMeme+1)){\n                setNextMeme(nextMeme+1)\n                setCurrentMeme(currentMeme+1)\n                console.log(\"error img\")\n                e.target.onerror = null\n                e.target.src=meme[nextMeme].media\n              }\n              else{\n                setMeme(shuffle(meme))\n                setNextMeme(0)\n                setCurrentMeme(1)\n                console.log(\"error img\")\n                e.target.onerror = null\n                e.target.src=meme[nextMeme].media\n              }\n            }}></img>\n            </div>\n          </div>:null}\n        <span className=\"timer\">{seconds}</span>\n      </header>\n\n      {/* <img src={\"https://i.redd.it/rs7pju6muo881.jpg\"} \n      onError={({ currentTarget }) => {\n        currentTarget.onerror = null; // prevents looping\n        currentTarget.src=\"https://i.redd.it/u6anbsaoed381.jpg\";\n      }}\n      \n    ></img> */}\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}